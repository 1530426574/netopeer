Summary: Netopeer - client web user interface
Name: netconfwebgui
Version: @VERSION@
Release: @RELEASE@
URL: http://www.liberouter.org/
Source: https://www.liberouter.org/repo/SOURCES/%{name}-%{version}-%{release}.tar.gz
Group: Liberouter
License: BSD
Vendor: CESNET, z.s.p.o.
Packager: @USERNAME@ <@USERMAIL@>
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}

BuildRequires: json-c-devel httpd-devel libnetconf-devel
Requires: httpd php php-xml python php-pdo php-process libnetconf json-c

%description
Web user interface for Netopeer client using Symfony2 framework.

%prep
%setup

%build
%configure --disable-composerinstall DESTDIR="${RPM_BUILD_ROOT}" httpdconfddir="$RPM_BUILD_ROOT/etc/httpd/conf.d" httpdconfdir="$RPM_BUILD_ROOT/etc/httpd/conf.d" httpdmoduledir="$RPM_BUILD_ROOT/etc/httpd/modules" webguidir="/var/www/" pyplugindir="$RPM_BUILD_ROOT/usr/lib/python2.6/site-packages/pyang/plugins" webguiname=@webguiname@
make

%pre

%install
make webguidir="$RPM_BUILD_ROOT/var/www/" install
cp mod_netconf.conf "${RPM_BUILD_ROOT}/etc/httpd/conf.d";
pwd; ls; ls ${RPM_BUILD_ROOT}

%post
#add device module to configuration only when installing, not on update or reinstall.
#https://fedoraproject.org/wiki/Packaging:Guidelines?rd=Packaging/Guidelines#Running_scriptlets_only_in_certain_situations
chcon system_u:object_r:httpd_modules_t:s0 /etc/httpd/modules/mod_netconf.so 2> /dev/null || true
setsebool httpd_can_network_connect=1 2> /dev/null || true
service httpd restart
echo -e 'Run this commands to complete installation:\ncd /var/www/netconfwebgui/ && php composer.phar install'

%postun
#delete device module from configuration only when erasing, not on update.
#https://fedoraproject.org/wiki/Packaging:Guidelines?rd=Packaging/Guidelines#Running_scriptlets_only_in_certain_situations
service httpd restart

%files
%{_sysconfdir}/httpd/modules/mod_netconf.so
%config(noreplace) %{_sysconfdir}/httpd/conf.d/*.conf
/var/www/@webguiname@/*
/usr/lib/python2.6/site-packages/pyang/plugins/nmp.py
/usr/lib/python2.6/site-packages/pyang/plugins/wyin.py
/usr/lib/python2.6/site-packages/pyang/plugins/resptempl.py

