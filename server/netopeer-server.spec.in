Summary: Netopeer - NETCONF implementation. Server part.
Name: netopeer-server
Version: %(cut -f1 ./VERSION | tr -d '\n')
Release: @RELEASE@
URL: http://www.liberouter.org/
Source: https://www.liberouter.org/repo/SOURCES/%{name}-%{version}-%{release}.tar.gz
Group: Liberouter
License: BSD
Vendor: CESNET, z.s.p.o.
Packager: @USERNAME@ <@USERMAIL@>
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}

BuildRequires: gcc make doxygen pkgconfig
BuildRequires: @BUILDREQS@
Requires: @REQS@

%description
Netopeer project implements NETCONF protocol for remote configuration of
network devices. This package contains its server part.

%package devel
Summary: Netopeer server development package.
Group: Liberouter
Requires: netopeer-server = %{version}-%{release}

%description devel
This package contains header files for netopeer server. Install this package
if you want to develop your own device modules.

%prep
%setup

%build
./configure --with-distro=@DISTRO@ --prefix=%{_prefix} @CONFIGURE_PARAMS@ --sysconfdir=%{_sysconfdir};
make
make doc

%install
make DESTDIR=$RPM_BUILD_ROOT install

%post
chown @USER@:@GROUP@ @DBUSCONF@/org.liberouter.netopeer.conf
chown @USER@:@GROUP@ @DBUSSERVICES@/org.liberouter.netopeer.server.service
chown -R @USER@:@GROUP@ %{_sysconfdir}/netopeer/

#SSHD config
if test -f /etc/ssh/sshd_config; then \
        grep -Ev "^Subsystem|^Port" /etc/ssh/sshd_config > %{_sysconfdir}/netopeer/sshd_config; \
else \
        touch %{_sysconfdir}/netopeer/sshd_config; \
fi; \
echo "" >> %{_sysconfdir}/netopeer/sshd_config; \
echo "# NETCONF SSH Subsystem settings" >> %{_sysconfdir}/netopeer/sshd_config; \
echo "Subsystem netconf %{_bindir}/netopeer-agent" >> %{_sysconfdir}/netopeer/sshd_config; \

%postun

%files
%{_bindir}/netopeer-server
%{_bindir}/netopeer-agent
%{_bindir}/netopeer-manager
@DBUSCONF@/org.liberouter.netopeer.conf
@DBUSSERVICES@/org.liberouter.netopeer.server.service
%{_sysconfdir}/netopeer/*
%{_sysconfdir}/init.d/netopeer.rc

